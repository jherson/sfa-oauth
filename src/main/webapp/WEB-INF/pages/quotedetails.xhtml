<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<rich:hotKey key="ctrl+s" enabledInInput="true">
		<a4j:ajax listener="#{quoteController.save()}" render="quotedetails" />
	</rich:hotKey>

	<a4j:outputPanel id="quotedetails">

		<rich:panel id="viewQuotePanel">

			<h:panelGrid width="100%" columns="1" cellpadding="3">
				<h:panelGroup layout="block">
					<h:graphicImage value="./images/quote.png"
						style="vertical-align: middle" />
					<h:outputText value=" " escape="false" />

					<h:outputText value="#{selectedQuote.name}"
						style="font-weight:bold; font-size: 18px;" />

				</h:panelGroup>
			</h:panelGrid>

			<rich:toolbar height="20" itemSeparator="grid">

				<rich:toolbarGroup location="left">
					<a4j:commandLink value="#{msgs.back}"
						disabled="#{quoteController.editMode}" status="waitstatus"
						render="mainArea" action="#{quoteController.backToQuoteManager()}">
					</a4j:commandLink>

					<a4j:commandLink id="followQuote"
						action="#{quoteController.followQuote(quote)}" render="quoteList"
						rendered="#{empty selectedQuote.userSubscriptionId}">
						<h:outputText value="#{msgs.follow}" />
					</a4j:commandLink>

					<a4j:commandLink id="unfollowQuote"
						action="#{quoteController.unfollowQuote(quote)}"
						rendered="#{not empty selectedQuote.userSubscriptionId}"
						render="quoteList">
						<h:outputText value="#{msgs.unfollow}" />
					</a4j:commandLink>

				</rich:toolbarGroup>

			</rich:toolbar>

			<h:panelGrid width="100%" columns="2" cellpadding="3"
				columnClasses="column35,column65">

				<h:panelGroup layout="block">

					<h:outputText value="#{msgs.quoteDetailsHeader}"
						style="font-weight: bold" />

				</h:panelGroup>

				<h:panelGroup layout="block">

					<a4j:commandButton id="edit" value="#{msgs.edit}"
						action="#{quoteController.editQuote()}" styleClass="commandButton"
						rendered="#{not quoteController.editMode}" ajaxSingle="true"
						disabled="#{empty selectedQuote}" render="quotedetails"
						oncomplete="#{rich:element('quoteForm:quoteName')}.focus()">
					</a4j:commandButton>

					<a4j:commandButton id="activate" value="#{msgs.activate}"
						styleClass="commandButton"
						rendered="#{not quoteController.editMode}" ajaxSingle="true"
						disabled="#{empty selectedQuote}" render="quotedetails">
					</a4j:commandButton>

					<a4j:commandButton id="copy" value="#{msgs.copy}"
						action="#{quoteController.copyQuote()}" styleClass="commandButton"
						rendered="#{not quoteController.editMode}" ajaxSingle="true"
						render="mainArea" disabled="#{empty selectedQuote}">
					</a4j:commandButton>

					<a4j:commandButton id="delete" value="#{msgs.delete}"
						action="#{quoteController.deleteQuote()}"
						styleClass="commandButton"
						rendered="#{not quoteController.editMode}" ajaxSingle="true"
						disabled="#{empty selectedQuote or selectedQuote.isActive}"
						render="mainArea">
					</a4j:commandButton>

					<a4j:commandButton id="save" value="#{msgs.save}"
						action="#{quoteController.save()}" styleClass="commandButton"
						rendered="#{quoteController.editMode}" execute="@form"
						render="quotedetails">
					</a4j:commandButton>

					<a4j:commandButton id="cancelEdit" value="#{msgs.cancel}"
						styleClass="commandButton" rendered="#{quoteController.editMode}"
						action="#{quoteController.cancelEdit()}" ajaxSingle="true"
						render="quotedetails">
					</a4j:commandButton>

				</h:panelGroup>

			</h:panelGrid>

			<table style="width: 100%">
				<tr>
					<th class="label-column"><h:outputText value="#{msgs.name}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.name}"
							rendered="#{not quoteController.editMode}" /> <h:inputText
							id="quoteName" required="true" value="#{selectedQuote.name}"
							style="width:300px" rendered="#{quoteController.editMode}"
							requiredMessage="#{msgs.quoteNameRequiredMessage}">
							<rich:validator />
						</h:inputText></td>
					<th class="label-column"><h:outputText value="#{msgs.number}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.number}" /></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.type}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.type}"
							rendered="#{not quoteController.editMode}" /> <h:selectOneMenu
							style="width: 150px;" value="#{selectedQuote.type}"
							rendered="#{quoteController.editMode}">
							<f:selectItem itemValue="Standard" />
							<f:selectItem itemValue="Co-Term" />
							<f:selectItem itemValue="Non Standard" />
							<a4j:ajax execute="@this" event="valueChange"
								render="viewQuotePanel" status="waitstatus" />
						</h:selectOneMenu></td>

					<th class="label-column"><h:outputText value="#{msgs.version}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.version}" /></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.active}" /></th>

					<td class="column-l-align"><h:graphicImage
							value="./images/active.png" rendered="#{selectedQuote.isActive}" /></td>

					<th class="label-column"><h:outputText
							value="#{msgs.currency}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.currencyIsoCode}"
							rendered="#{not quoteController.editMode or selectedQuote.hasQuoteLineItems}" />
						<h:selectOneMenu value="#{selectedQuote.currencyIsoCode}"
							style="width: 75px;"
							rendered="#{quoteController.editMode and not selectedQuote.hasQuoteLineItems}">

							<f:selectItems value="#{currencyIsoCodes}" />

							<a4j:ajax execute="@this" event="valueChange"
								render="viewQuoteProducts">
							</a4j:ajax>

						</h:selectOneMenu></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.payNow}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.payNow}"
							rendered="#{not quoteController.editMode}" /> <h:selectOneMenu
							style="width: 75px;" value="#{selectedQuote.payNow}"
							rendered="#{quoteController.editMode}">
							<f:selectItem itemValue="Yes" />
							<f:selectItem itemValue="No" />
						</h:selectOneMenu></td>

					<th class="label-column"><h:outputText value="#{msgs.amount}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.amount}">
							<f:convertNumber locale="#{user.locale}"
								pattern="#,##0.00;(#,##0.00)" />
						</h:outputText></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.owner}" /></th>

					<td class="column-l-align"><h:outputText id="ownerName"
							value="#{selectedQuote.ownerName}" /> <a4j:commandLink
							id="changeOwner" value="#{msgs.change}"
							oncomplete="#{rich:component('ownerPanel')}.show()"
							status="waitstatus" rendered="#{quoteController.editMode}"
							rerender="#{rich:clientId('ownerPanel')}" ajaxSingle="true">
						</a4j:commandLink></td>

					<th class="label-column"><h:outputText value="#{msgs.contact}" /></th>
					<td class="column-l-align"><h:outputText id="contactName"
							value="#{selectedQuote.contactName}" /> <a4j:commandLink
							id="changeContact" value="#{msgs.change}"
							oncomplete="#{rich:component('contactPanel')}.show()"
							rendered="#{quoteController.editMode}"
							rerender="#{rich:clientId('contactPanel')}" ajaxSingle="true">
						</a4j:commandLink></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.effectiveDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.effectiveDate}"
							rendered="#{not quoteController.editMode}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar value="#{selectedQuote.effectiveDate}"
							id="effectiveDate" locale="en_US" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							disabled="false" rendered="#{quoteController.editMode}">
						</rich:calendar></td>

					<th class="label-column"><h:outputText
							value="#{msgs.expirationDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.expirationDate}"
							rendered="#{not quoteController.editMode}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar value="#{selectedQuote.expirationDate}"
							id="expirationDate" locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							disabled="false" rendered="#{quoteController.editMode}">
						</rich:calendar></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.referenceNumber}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.referenceNumber}"
							rendered="#{not quoteController.editMode}" /> <h:inputText
							value="#{selectedQuote.referenceNumber}"
							rendered="#{quoteController.editMode}" /></td>

					<th class="label-column"><h:outputText value="#{msgs.term}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.term}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Standard'}">
							<f:convertNumber locale="#{user.locale}" pattern="#,##0" />
						</h:outputText> <h:selectOneMenu value="#{selectedQuote.term}"
							rendered="#{quoteController.editMode and selectedQuote.type == 'Standard'}"
							style="width: 75px">
							<f:selectItem itemLabel="1" itemValue="365" />
							<f:selectItem itemLabel="3" itemValue="1095" />
							<a4j:ajax event="valueChange"
								listener="#{quoteDateController.setDates()}"
								render="quotedetails">
							</a4j:ajax>
						</h:selectOneMenu></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.startDate}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.startDate}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Standard'}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar value="#{selectedQuote.startDate}" id="startDate"
							locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							rendered="#{quoteController.editMode and selectedQuote.type == 'Standard'}"
							disabled="false">
							<a4j:ajax event="change"
								listener="#{quoteDateController.setDates()}"
								render="quotedetails">
							</a4j:ajax>

						</rich:calendar></td>

					<th class="label-column"><h:outputText value="#{msgs.endDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.endDate}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Co-Term'}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar value="#{selectedQuote.endDate}" id="endDate"
							locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							rendered="#{quoteController.editMode and selectedQuote.type == 'Co-Term'}"
							disabled="false">
						</rich:calendar></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.createdBy}"
							rendered="#{not quoteController.editMode}" /></th>

					<td class="column-l-align"><h:panelGroup>
							<h:outputText value="#{selectedQuote.createdByName}, "
								rendered="#{not quoteController.editMode and not empty selectedQuote}" />
							<h:outputText value="#{selectedQuote.createdDate}"
								rendered="#{not quoteController.editMode and not empty selectedQuote}">
								<f:convertDateTime locale="#{user.locale}"
									timeZone="#{user.timeZone}"
									pattern="#{user.dateTimeFormatPattern}" type="date" />
							</h:outputText>
							<h:outputText value=" " rendered="#{empty selectedQuote}" />
						</h:panelGroup></td>

					<th class="label-column"><h:outputText
							value="#{msgs.lastModifiedBy}"
							rendered="#{not quoteController.editMode}" /></th>

					<td class="column-l-align"><h:panelGroup>
							<h:outputText value="#{selectedQuote.lastModifiedByName}, "
								rendered="#{not quoteController.editMode and not empty selectedQuote}" />
							<h:outputText value="#{selectedQuote.lastModifiedDate}"
								rendered="#{not quoteController.editMode and not empty selectedQuote}">
								<f:convertDateTime locale="#{user.locale}"
									timeZone="#{user.timeZone}"
									pattern="#{user.dateTimeFormatPattern}" type="date" />
							</h:outputText>
							<h:outputText value=" " rendered="#{empty selectedQuote}" />
						</h:panelGroup></td>
				</tr>

			</table>

			<br />
			<ui:include src="quotepriceadjustments.xhtml" />

			<br />

			<ui:include src="quotelineitems.xhtml" />

			<ui:include src="owners.xhtml" />
			<ui:include src="contacts.xhtml" />
		</rich:panel>

	</a4j:outputPanel>
</ui:composition>