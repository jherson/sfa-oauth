<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<a4j:outputPanel id="quotedetails">

		<rich:toolbar height="20" itemSeparator="grid">

			<rich:toolbarGroup location="left">
				<a4j:commandLink value="#{msgs.back}"				
					disabled="#{quoteController.editMode}" status="waitstatus"
					render="mainArea" action="#{quoteController.backToQuoteManager()}">
				</a4j:commandLink>
			</rich:toolbarGroup>

			<rich:toolbarGroup location="right">

				<a4j:commandLink id="edit" action="#{quoteController.editQuote()}"
					rendered="#{not quoteController.editMode}" ajaxSingle="true"
					disabled="#{empty selectedQuote}"
					render="quotedetails"
					oncomplete="#{rich:element('quoteForm:quoteName')}.focus()">
					<h:outputText value="#{msgs.edit}" />
				</a4j:commandLink>		
				
				<a4j:commandLink id="calculate"
					rendered="#{not quoteController.editMode}"
					action="#{quoteController.calculateQuote()}" ajaxSingle="true"
					render="quotedetails">
					<h:outputText value="#{msgs.calculate}" />
				</a4j:commandLink>	

				<a4j:commandLink id="activate"
					action="#{quoteController.activateQuote()}"
					rendered="#{not quoteController.editMode}" ajaxSingle="true"
					disabled="#{empty selectedQuote}"
					render="quotedetails">
					<h:outputText value="#{msgs.activate}" />
				</a4j:commandLink>

				<a4j:commandLink id="copy" 
				    action="#{quoteController.copyQuote()}"
					rendered="#{not quoteController.editMode}" ajaxSingle="true"
					render="mainArea" disabled="#{empty selectedQuote}">
					<h:outputText value="#{msgs.copy}" />
				</a4j:commandLink>

				<a4j:commandLink id="delete"
					action="#{quoteController.deleteQuote()}"
					rendered="#{not quoteController.editMode}" ajaxSingle="true"
					disabled="#{empty selectedQuote or selectedQuote.isActive}"
					render="mainArea">
					<h:outputText value="#{msgs.delete}" />
				</a4j:commandLink>

				<a4j:commandLink id="save" action="#{quoteController.save()}"
					rendered="#{quoteController.editMode}" execute="@form" 
					render="quotedetails">
					<h:outputText value="#{msgs.save}" />
				</a4j:commandLink>

				<a4j:commandLink id="cancelEdit"
					rendered="#{quoteController.editMode}"
					action="#{quoteController.cancelEdit()}" ajaxSingle="true"
					render="quotedetails">
					<h:outputText value="#{msgs.cancel}" />
				</a4j:commandLink>

			</rich:toolbarGroup>
		</rich:toolbar>

		<rich:panel id="viewQuotePanel">
		
			<table style="width: 100%">
				<tr>
					<th class="label-column"><h:outputText value="#{msgs.name}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.name}"
							rendered="#{not quoteController.editMode}" /> <h:inputText
							id="quoteName" required="true"
							value="#{selectedQuote.name}" style="width:300px"
							rendered="#{quoteController.editMode}"
							requiredMessage="#{msgs.quoteNameRequiredMessage}">
							<rich:validator />
						</h:inputText></td>
					<th class="label-column"><h:outputText value="#{msgs.number}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.number}" /></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.type}" /></th>

					<td class="column-l-align">
					    <h:outputText
							value="#{selectedQuote.type}"
							rendered="#{not quoteController.editMode}" /> 
						<h:selectOneMenu style="width: 150px;"
							value="#{selectedQuote.type}"
							rendered="#{quoteController.editMode}">
							<f:selectItem itemValue="Standard" />
							<f:selectItem itemValue="Co-Term" />
							<f:selectItem itemValue="Non Standard" />
							<a4j:ajax execute="@this" 
							    event="valueChange" 
							    render="viewQuotePanel"
								status="waitstatus" />
						</h:selectOneMenu></td>

					<th class="label-column"><h:outputText value="#{msgs.version}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.version}" /></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.active}" /></th>

					<td class="column-l-align"><h:graphicImage
							value="./images/active.png"
							rendered="#{selectedQuote.isActive}" /></td>

					<th class="label-column"><h:outputText
							value="#{msgs.currency}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.currencyIsoCode}"
							rendered="#{not quoteController.editMode or selectedQuote.hasQuoteLineItems}" />
						<h:selectOneMenu
							value="#{selectedQuote.currencyIsoCode}"
							style="width: 75px;"
							rendered="#{quoteController.editMode and not selectedQuote.hasQuoteLineItems}">

							<f:selectItems value="#{currencyIsoCodes}" />

							<a4j:ajax execute="@this" event="valueChange"
								render="viewQuoteProducts">
							</a4j:ajax>

						</h:selectOneMenu></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.payNow}" /></th>

					<td class="column-l-align">
					    <h:outputText
							value="#{selectedQuote.payNow}"
							rendered="#{not quoteController.editMode}" /> 
						<h:selectOneMenu
						    style="width: 75px;"
							value="#{selectedQuote.payNow}"
							rendered="#{quoteController.editMode}">
							<f:selectItem itemValue="Yes" />
							<f:selectItem itemValue="No" />
						</h:selectOneMenu></td>

					<th class="label-column"><h:outputText value="#{msgs.amount}" /></th>

					<td class="column-l-align">
					    <h:outputText
							value="#{selectedQuote.amount}">
							<f:convertNumber locale="#{user.locale}"
								pattern="#,##0.00;(#,##0.00)" />
						</h:outputText></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText value="#{msgs.owner}" /></th>

					<td class="column-l-align">
							<h:outputText id="ownerName"
								value="#{selectedQuote.ownerName}" />

							<a4j:commandLink id="changeOwner" value="#{msgs.change}"
								oncomplete="#{rich:component('ownerPanel')}.show()"
								status="waitstatus" rendered="#{quoteController.editMode}"
								rerender="#{rich:clientId('ownerPanel')}" ajaxSingle="true">
							</a4j:commandLink>

				</td>

					<th class="label-column"><h:outputText value="#{msgs.contact}" /></th>
					<td class="column-l-align">
							<h:outputText id="contactName"
								value="#{selectedQuote.contactName}" />

							<a4j:commandLink id="changeContact" value="#{msgs.change}"
								oncomplete="#{rich:component('contactPanel')}.show()"
								rendered="#{quoteController.editMode}"
								rerender="#{rich:clientId('contactPanel')}" ajaxSingle="true">
							</a4j:commandLink>

						</td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.effectiveDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.effectiveDate}"
							rendered="#{not quoteController.editMode}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar
							value="#{selectedQuote.effectiveDate}"
							id="effectiveDate" locale="en_US" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							disabled="false" rendered="#{quoteController.editMode}">
						</rich:calendar></td>

					<th class="label-column"><h:outputText
							value="#{msgs.expirationDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.expirationDate}"
							rendered="#{not quoteController.editMode}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar
							value="#{selectedQuote.expirationDate}"
							id="expirationDate" locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							disabled="false" rendered="#{quoteController.editMode}">
						</rich:calendar></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.referenceNumber}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.referenceNumber}"
							rendered="#{not quoteController.editMode}" /> <h:inputText
							value="#{selectedQuote.referenceNumber}"
							rendered="#{quoteController.editMode}" /></td>

					<th class="label-column"><h:outputText value="#{msgs.term}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.term}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Standard'}">
							<f:convertNumber locale="#{user.locale}" pattern="#,##0" />
						</h:outputText> <h:selectOneMenu value="#{selectedQuote.term}"
							rendered="#{quoteController.editMode and selectedQuote.type == 'Standard'}"
							style="width: 75px">
							<f:selectItem itemLabel="1" itemValue="365" />
							<f:selectItem itemLabel="3" itemValue="1095" />
							<a4j:ajax event="valueChange"
							    listener="#{quoteDateController.setDates()}"
								render="quotedetails">
							</a4j:ajax>
						</h:selectOneMenu></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.startDate}" /></th>

					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.startDate}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Standard'}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> 
						<rich:calendar value="#{selectedQuote.startDate}"
							id="startDate" locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"							
							rendered="#{quoteController.editMode and selectedQuote.type == 'Standard'}"
							disabled="false">
							<a4j:ajax event="change"
							    listener="#{quoteDateController.setDates()}"
								render="quotedetails">
							</a4j:ajax>
							
						</rich:calendar></td>

					<th class="label-column"><h:outputText value="#{msgs.endDate}" /></th>
					<td class="column-l-align"><h:outputText
							value="#{selectedQuote.endDate}"
							rendered="#{not quoteController.editMode or selectedQuote.type != 'Co-Term'}">
							<f:convertDateTime locale="#{user.locale}"
								pattern="#{user.dateFormatPattern}" type="date" />
						</h:outputText> <rich:calendar value="#{selectedQuote.endDate}"
							id="endDate" locale="#{user.locale}" popup="true"
							datePattern="#{user.dateFormatPattern}" showApplyButton="false"
							cellWidth="24px" cellHeight="22px" style="width:200px"
							rendered="#{quoteController.editMode and selectedQuote.type == 'Co-Term'}"
							disabled="false">
						</rich:calendar></td>
				</tr>

				<tr>
					<th class="label-column"><h:outputText
							value="#{msgs.createdBy}"
							rendered="#{not quoteController.editMode}" /></th>

					<td class="column-l-align"><h:panelGroup>
							<h:outputText
								value="#{selectedQuote.createdByName}, "
								rendered="#{not quoteController.editMode and not empty selectedQuote}" />
							<h:outputText
								value="#{selectedQuote.createdDate}"
								rendered="#{not quoteController.editMode and not empty selectedQuote}">
								<f:convertDateTime locale="#{user.locale}"
								    timeZone="#{user.timeZone}"
									pattern="#{user.dateTimeFormatPattern}" type="date" />
							</h:outputText>
							<h:outputText value=" "
								rendered="#{empty selectedQuote}" />
						</h:panelGroup></td>

					<th class="label-column"><h:outputText
							value="#{msgs.lastModifiedBy}"
							rendered="#{not quoteController.editMode}" /></th>

					<td class="column-l-align"><h:panelGroup>
							<h:outputText
								value="#{selectedQuote.lastModifiedByName and not empty selectedQuote}, "
								rendered="#{not quoteController.editMode}" />
							<h:outputText
								value="#{selectedQuote.lastModifiedDate}"
								rendered="#{not quoteController.editMode and not empty selectedQuote}">
								<f:convertDateTime locale="#{user.locale}"
								    timeZone="#{user.timeZone}"
									pattern="#{user.dateTimeFormatPattern}" type="date" />
							</h:outputText>
							<h:outputText value=" "
								rendered="#{empty selectedQuote}" />
						</h:panelGroup></td>
				</tr>

			</table>
			
			<br />
			<ui:include src="quotepriceadjustmentlist.xhtml" />

			<br />

			<ui:include src="quoteproductslist.xhtml" />

			<ui:include src="owners.xhtml" />
			<ui:include src="contacts.xhtml" />

		</rich:panel>

	</a4j:outputPanel>
</ui:composition>