<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
		
<rich:toolbar height="20" itemSeparator="grid" style="border: 1;">

    <rich:toolbarGroup location="left" >
        <a4j:commandLink value="#{msgs.back}" 
            disabled="#{quoteForm.editMode}"
		    immediate="false" render="mainArea" status="ajaxStatus"
		    action="#{quoteController.back()}">
	    </a4j:commandLink>		
    </rich:toolbarGroup>

	<rich:toolbarGroup location="right">

		<a4j:commandLink id="edit"		
			rendered="#{not quoteForm.editMode}" ajaxSingle="true"
			disabled="#{empty quoteController.selectedQuote}" render="details"
			oncomplete="#{rich:element('quoteForm:quoteName')}.focus()"
			status="ajaxStatus">			
			<f:setPropertyActionListener value="#{true}" target="#{quoteForm.editMode}"/>
			<h:outputText value="#{msgs.edit}" />			
		</a4j:commandLink>

		<a4j:commandLink id="activate"
			action="#{quoteController.activateQuote()}"
			rendered="#{not quoteForm.editMode}" ajaxSingle="true"
			disabled="#{empty quoteController.selectedQuote}"
			render="details">
			<h:outputText value="#{msgs.activate}" />
		</a4j:commandLink>

		<a4j:commandLink id="copy"
			action="#{quoteController.copyQuote()}"
			rendered="#{not quoteForm.editMode}" ajaxSingle="true"
			render="mainArea" disabled="#{empty quoteController.selectedQuote}">
			<h:outputText value="#{msgs.copy}" />
		</a4j:commandLink>

		<a4j:commandLink id="delete"
			action="#{quoteController.deleteQuote()}"
			rendered="#{not quoteForm.editMode}" ajaxSingle="true"
			disabled="#{empty quoteController.selectedQuote or quoteController.selectedQuote.isActive}"
			render="mainArea">
			<h:outputText value="#{msgs.delete}" />
		</a4j:commandLink>

		<a4j:commandLink id="save" 
			action="#{quoteController.save()}"
			rendered="#{quoteForm.editMode}" render="mainArea"
			ajaxSingle="true" >
			<f:setPropertyActionListener value="#{false}" target="#{quoteForm.editMode}"/>
			<h:outputText value="#{msgs.save}" />			
		</a4j:commandLink>
		
		<a4j:commandLink id="reset" 
			rendered="#{quoteForm.editMode}" 
			action="#{quoteController.reset()}"
			render="mainArea" ajaxSingle="true" 
			bypassUpdates="true"
			type="reset"
			immediate="true">
			<f:setPropertyActionListener value="#{false}" target="#{quoteForm.editMode}"/>
			<h:outputText value="#{msgs.cancel}" />
		</a4j:commandLink>

	</rich:toolbarGroup>
</rich:toolbar>

<rich:panel id="viewQuotePanel"
	style="border-color: #C27E3A; background-color: #FCF9F5; ">
	
	<h:panelGrid styleClass="rf-dt" width="100%"
		style="background-color: #FCF9F5; 
		border-right-style: hidden; border-top-style: hidden; border-left-style: hidden; border-bottom-style: hidden;"
		columnClasses="label-column,column-l-align,label-column,column-l-align"
		columns="4">

		<h:outputText value="#{msgs.name}" />
		<h:outputText value="#{quoteController.selectedQuote.name}"
			rendered="#{not quoteForm.editMode}" />
		<h:inputText id="quoteName" required="true"
			value="#{quoteController.selectedQuote.name}" style="width:300px"
			rendered="#{quoteForm.editMode}"
			requiredMessage="#{msgs.quoteNameRequiredMessage}">
			<rich:validator />
		</h:inputText>

		<h:outputText value="#{msgs.number}" />
		<h:outputText value="#{quoteController.selectedQuote.number}" />

		<h:outputText value="#{msgs.type}" />
		<h:outputText value="#{quoteController.selectedQuote.type}"
			rendered="#{not quoteForm.editMode}" />
		<h:selectOneMenu value="#{quoteController.selectedQuote.type}"
			rendered="#{quoteForm.editMode}">
			<f:selectItem itemValue="Standard" />
			<f:selectItem itemValue="Co-Term" />
			<f:selectItem itemValue="Non Standard" />
			<a4j:ajax event="valueChange" render="viewQuotePanel"
				status="ajaxStatus" />
		</h:selectOneMenu>

		<h:outputText value="#{msgs.version}" />
		<h:outputText value="#{quoteController.selectedQuote.version}" />

		<h:outputText value="#{msgs.active}" />
		<h:panelGroup>
			<h:graphicImage value="./images/active.png"
				rendered="#{quoteController.selectedQuote.isActive}" />
		</h:panelGroup>

		<h:outputText value="#{msgs.currency}" />
		<h:outputText value="#{quoteController.selectedQuote.currencyIsoCode}"
			rendered="#{not quoteForm.editMode or quoteController.selectedQuote.hasQuoteLineItems}" />
		<h:selectOneMenu value="#{quoteController.selectedQuote.currencyIsoCode}" style="width: 75px;"
			rendered="#{quoteForm.editMode and not quoteController.selectedQuote.hasQuoteLineItems}"
			status="ajaxStatus">
			
			<f:selectItems value="#{quoteBuilder.currencyIsoCodes}" />
			
			<a4j:ajax execute="@this" event="valueChange"
				render="viewQuoteProducts">					  
			</a4j:ajax>
			
		</h:selectOneMenu>

		<h:outputText value="#{msgs.payNow}" />
		<h:outputText value="#{quoteController.selectedQuote.payNow}"
			rendered="#{not quoteForm.editMode}" />
		<h:selectOneMenu value="#{quoteController.selectedQuote.payNow}"
			rendered="#{quoteForm.editMode}">
			<f:selectItem itemValue="Yes" />
			<f:selectItem itemValue="No" />
		</h:selectOneMenu>

		<h:outputText value="#{msgs.amount}" />
		<h:outputText value="#{quoteController.selectedQuote.amount}">
			<f:convertNumber locale="#{sessionUser.locale}"
				pattern="#,##0.00;(#,##0.00)" />
		</h:outputText>

		<h:outputText value="#{msgs.owner}" />
		<h:outputText value="#{quoteController.selectedQuote.ownerName}"
			rendered="#{not quoteForm.editMode}" />

		<h:panelGroup rendered="#{quoteForm.editMode}">
			<h:outputText id="ownerName"
				value="#{quoteController.selectedQuote.ownerName}" />

			<h:outputText value=" " />

			<a4j:commandLink id="changeOwner"
				oncomplete="#{rich:component('ownerPanel')}.show()"
				status="ajaxStatus"
				rerender="#{rich:clientId('ownerPanel')}" ajaxSingle="true">

				<h:graphicImage value="./images/search.png" title="#{msgs.change}" />

			</a4j:commandLink>

		</h:panelGroup>

		<h:outputText value="#{msgs.contact}" />
		<h:outputText value="#{quoteController.selectedQuote.contactName}"
			rendered="#{not quoteForm.editMode}" />
		<h:panelGroup rendered="#{quoteForm.editMode}">
			<h:outputText value="#{quoteController.selectedQuote.contactName}" />

			<h:outputText value=" " />

			<a4j:commandLink id="changeContact"
				oncomplete="#{rich:component('contactPanel')}.show()"
				status="ajaxStatus"
				reRender="#{rich:clientId('contactPanel')}" ajaxSingle="true">

				<h:graphicImage value="./images/search.png" title="#{msgs.change}" />

			</a4j:commandLink>

		</h:panelGroup>

		<h:outputText value="#{msgs.effectiveDate}" />
		<h:outputText value="#{quoteController.selectedQuote.effectiveDate}"
			rendered="#{not quoteForm.editMode}">
			<f:convertDateTime locale="#{sessionUser.locale}"
				pattern="#{sessionUser.dateFormatPattern}" type="date" />
		</h:outputText>

		<h:panelGroup rendered="#{quoteForm.editMode}">
			<h:outputText value="#{quoteController.selectedQuote.effectiveDate}"
				rendered="#{quoteController.opportunity.isClosed or empty quoteController.selectedQuote}" />

			<rich:calendar value="#{quoteController.selectedQuote.effectiveDate}"
				id="effectiveDate" locale="#{sessionUser.locale}"
				popup="true"
				datePattern="#{sessionUser.dateFormatPattern}"
				showApplyButton="false" cellWidth="24px" cellHeight="22px"
				style="width:200px" disabled="false">
			</rich:calendar>

		</h:panelGroup>

		<h:outputText value="#{msgs.expirationDate}" />
		<h:outputText value="#{quoteController.selectedQuote.expirationDate}"
			rendered="#{not quoteForm.editMode}">
			<f:convertDateTime locale="#{sessionUser.locale}"
				pattern="#{sessionUser.dateFormatPattern}" type="date" />
		</h:outputText>

		<h:panelGroup rendered="#{quoteForm.editMode}">
			<h:outputText value="#{quoteController.selectedQuote.expirationDate}"
				rendered="#{not quoteForm.editMode}" />

			<rich:calendar value="#{quoteController.selectedQuote.expirationDate}"
				id="expirationDate" locale="#{sessionUser.locale}"
				popup="true"
				datePattern="#{sessionUser.dateFormatPattern}"
				showApplyButton="false" cellWidth="24px" cellHeight="22px"
				style="width:200px" disabled="false">
			</rich:calendar>
		</h:panelGroup>

		<h:outputText value="#{msgs.referenceNumber}" />
		<h:outputText value="#{quoteController.selectedQuote.referenceNumber}"
			rendered="#{not quoteForm.editMode}" />
		<h:inputText value="#{quoteController.selectedQuote.referenceNumber}"
			rendered="#{quoteForm.editMode}" />

		<h:outputText value="#{msgs.term}" />
		<h:outputText value="#{quoteController.selectedQuote.term}"
			rendered="#{not quoteForm.editMode or quoteController.selectedQuote.type != 'Standard'}">
			<f:convertNumber locale="#{sessionUser.locale}"
				pattern="#,##0" />
		</h:outputText>
		<h:selectOneMenu value="#{quoteController.selectedQuote.term}"
			rendered="#{quoteForm.editMode and quoteController.selectedQuote.type == 'Standard'}">
			<f:selectItem itemLabel="1" itemValue="365" />
			<f:selectItem itemLabel="3" itemValue="1095" />
		</h:selectOneMenu>

		<h:outputText value="#{msgs.startDate}" />
		<h:panelGroup>
			<h:outputText value="#{quoteController.selectedQuote.startDate}"
				rendered="#{not quoteForm.editMode or quoteController.selectedQuote.type != 'Standard'}">
				<f:convertDateTime locale="#{sessionUser.locale}"
					pattern="#{sessionUser.dateFormatPattern}"
					type="date" />
			</h:outputText>
			<rich:calendar value="#{quoteController.selectedQuote.startDate}"
				id="startDate" locale="#{sessionUser.locale}"
				popup="true"
				datePattern="#{sessionUser.dateFormatPattern}"
				showApplyButton="false" cellWidth="24px" cellHeight="22px"
				style="width:200px"
				rendered="#{quoteForm.editMode and quoteController.selectedQuote.type == 'Standard'}"
				disabled="false">
			</rich:calendar>
		</h:panelGroup>

		<h:outputText value="#{msgs.endDate}" />
		<h:panelGroup>
			<h:outputText value="#{quoteController.selectedQuote.endDate}"
				rendered="#{not quoteForm.editMode or quoteController.selectedQuote.type != 'Co-Term'}">
				<f:convertDateTime locale="#{sessionUser.locale}"
					pattern="#{sessionUser.dateFormatPattern}"
					type="date" />
			</h:outputText>
			<rich:calendar value="#{quoteController.selectedQuote.endDate}"
				id="endDate" locale="#{sessionUser.locale}"
				popup="true"
				datePattern="#{sessionUser.dateFormatPattern}"
				showApplyButton="false" cellWidth="24px" cellHeight="22px"
				style="width:200px"
				rendered="#{quoteForm.editMode and quoteController.selectedQuote.type == 'Co-Term'}"
				disabled="false">
			</rich:calendar>
		</h:panelGroup>

		<h:outputText value="#{msgs.createdBy}"
			rendered="#{not quoteForm.editMode}" />			
		<h:panelGroup>
			<h:outputText value="#{quoteController.selectedQuote.createdByName}, "
			    rendered="#{not quoteForm.editMode and not empty quoteController.selectedQuote}"/>
			<h:outputText value="#{quoteController.selectedQuote.createdDate}"
			    rendered="#{not quoteForm.editMode and not empty quoteController.selectedQuote}">
				<f:convertDateTime locale="#{sessionUser.locale}"
					pattern="#{sessionUser.dateTimeFormatPattern}"
					type="date" />
			</h:outputText>
			<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		</h:panelGroup>

		<h:outputText value="#{msgs.lastModifiedBy}"
			rendered="#{not quoteForm.editMode}" />
		<h:panelGroup>
			<h:outputText value="#{quoteController.selectedQuote.lastModifiedByName}, "
			    rendered="#{not quoteForm.editMode and not empty quoteController.selectedQuote}"/>
			<h:outputText value="#{quoteController.selectedQuote.lastModifiedDate}"
			    rendered="#{not quoteForm.editMode and not empty quoteController.selectedQuote}">
				<f:convertDateTime locale="#{sessionUser.locale}"
					pattern="#{sessionUser.dateTimeFormatPattern}"
					type="date" />
			</h:outputText>
			<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		</h:panelGroup>
		
		<h:outputText value=" " rendered="#{quoteForm.editMode}" />
		<h:outputText value=" " rendered="#{quoteForm.editMode}" />
		<h:outputText value=" " rendered="#{quoteForm.editMode}" />
		<h:outputText value=" " rendered="#{quoteForm.editMode}" />
		

	</h:panelGrid>

	<hr style="background-color: #C27E3A; border: 0; height: 1px;" />

	<h:panelGrid styleClass="rf-dt" width="100%"
		style="background-color: #FCF9F5; 
		border-right-style: hidden; border-top-style: hidden; border-left-style: hidden; border-bottom-style: hidden;"
		columnClasses="label-column,column-l-align,label-column,column-l-align"
		columns="4">

		<h:outputText value="#{msgs.billingAddress}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.billingAddress}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.shippingAddress}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.shippingAddress}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.billingCity}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.billingCity}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.shippingCity}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.shippingCity}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.billingState}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.billingState}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.shippingState}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.shippingState}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.billingZipPostalCode}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.billingZipPostalCode}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.shippingZipPostalCode}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.shippingZipPostalCode}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.billingCountry}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.billingCountry}"
			rendered="#{not empty quoteController.selectedQuote}" />

		<h:outputText value="#{msgs.shippingCountry}" />
		<h:outputText value=" " rendered="#{empty quoteController.selectedQuote}" />
		<h:outputText value="#{quoteController.opportunity.shippingCountry}"
			rendered="#{not empty quoteController.selectedQuote}" />

	</h:panelGrid>

	<hr style="background-color: #C27E3A; border: 0; height: 1px;" />

	<ui:include src="viewpriceadjustments.xhtml" />

	<br />
	
	<ui:include src="viewquoteproducts.xhtml" />

</rich:panel>
</html>