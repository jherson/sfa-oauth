<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

	<a4j:status id="ajaxStatus" forceId="true"
		onstart="#{rich:component('statusPane')}.show()"
		onstop="#{rich:component('statusPane')}.hide()" />



	<h:form id="quoteForm">

		<ui:include src="owners.xhtml" />
		<ui:include src="contacts.xhtml" />
		<ui:include src="addopportunityproducts.xhtml" />

		<rich:toolbar height="26" itemSeparator="grid">
			<rich:toolbarGroup>
				<h:outputText
					value="#{msgs.headerTitle}: #{quoteForm.opportunity.name}" />
			</rich:toolbarGroup>
			<rich:toolbarGroup location="right">

				<a4j:commandButton id="new" value="#{msgs.new}"
					action="#{quoteManager.newQuote(quoteForm.opportunity)}"
					styleClass="button"
					rendered="#{not quoteForm.opportunity.isClosed}"
					focus="#{rich:clientId('name')}" render="quoteList, :details"
					ajaxSingle="true" />

				<h:outputText value=" " />

				<a4j:commandButton value="#{msgs.refresh}"
					action="#{quoteManager.refresh()}" styleClass="button"
					ajaxSingle="true" render="quoteList, :details" status="ajaxStatus" />

			</rich:toolbarGroup>
		</rich:toolbar>

		<rich:extendedDataTable id="quoteList" var="quote"
			value="#{quoteForm.quoteList}" noDataLabel="#{msgs.noRecords}"
			selection="#{quoteForm.selection}" style="height:220px;"
			selectedClass="dataTableSelectedRow" status="ajaxStatus">

			<a4j:ajax execute="@this" event="selectionchange"
				listener="#{quoteForm.selectionListener}" render=":details" />

			<rich:column width="75px">
				<f:facet name="header">#{msgs.action}</f:facet>

				<a4j:commandLink id="activate"
					action="#{quoteManager.activateQuote(quote)}" ajaxSingle="true"
					styleClass="no-decor" status="ajaxStatus"
					render="quoteList, :details">
					<h:graphicImage value="./images/activate.png"
						title="#{msgs.activate}" />
				</a4j:commandLink>

				<h:outputText value="  " escape="false" />

				<a4j:commandLink id="copy" action="#{quoteManager.copyQuote(quote)}"
					ajaxSingle="true" render="quoteList" styleClass="no-decor"
					status="ajaxStatus">
					<h:graphicImage value="./images/copy.png" title="#{msgs.copy}" />
				</a4j:commandLink>

				<h:outputText value="  " escape="false" />

				<a4j:commandLink id="delete" rendered="#{not quote.isActive}"
					action="#{quoteManager.deleteQuote(quote)}" styleClass="no-decor"
					ajaxSingle="true" status="ajaxStatus" render="quoteList, :details">
					<h:graphicImage value="./images/delete.png" title="#{msgs.delete}" />
				</a4j:commandLink>
			</rich:column>

			<rich:column style="text-align: right;">
				<f:facet name="header">#{msgs.number}</f:facet>
				<a4j:commandLink value="#{quote.number}" />
			</rich:column>

			<rich:column width="400px">
				<f:facet name="header">#{msgs.name}</f:facet>
				<h:outputText value="#{quote.name}" />
			</rich:column>

			<rich:column>
				<f:facet name="header">#{msgs.type}</f:facet>
				<h:outputText value="#{quote.type}" />
			</rich:column>

			<rich:column width="70px" style="text-align: center;">
				<f:facet name="header">#{msgs.active}</f:facet>
				<h:graphicImage value="./images/active.png" styleClass="centered"
					rendered="#{quote.isActive}" />
			</rich:column>

			<rich:column>
				<f:facet name="header">#{msgs.amount} </f:facet>
				<h:outputText value="#{quote.currencyIsoCode}" />
				<h:outputText value="  " escape="false" />
				<h:outputText value="#{quote.amount}">
					<f:convertNumber locale="#{sforceSession.sessionUser.locale}"
						pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
				</h:outputText>
			</rich:column>

			<rich:column>
				<f:facet name="header">#{msgs.owner}</f:facet>
				<h:outputText value="#{quote.ownerName}" />
			</rich:column>

			<rich:column>
				<f:facet name="header">#{msgs.contact}</f:facet>
				<h:outputText value="#{quote.contactName}" />
			</rich:column>

		</rich:extendedDataTable>

		<br />

		<rich:popupPanel id="statusPane" autosized="true">
			<h:graphicImage value="./images/ajax-loader.gif" alt="ajax-loader" />
		</rich:popupPanel>

		<a4j:outputPanel id="messages" ajaxRendered="true">
			<rich:messages />
		</a4j:outputPanel>

		<a4j:outputPanel id="details">

			<ui:include src="viewquotepanel.xhtml" />

			<br />

			<rich:panel>
				<f:facet name="header">
					<h:outputText value="#{msgs.quoteDetailsHeader}" />
				</f:facet>

				<h:panelGrid styleClass="rf-dt" rowClasses="rf-dt-c"
					style="width: 100%; border-right-style: hidden; border-top-style: hidden; border-left-style: hidden; "
					columnClasses="label-column,column-l-align,label-column,column-l-align"
					columns="4">

					<h:outputText value="#{msgs.name}" />
					<h:inputText id="name" required="true"
						value="#{quoteForm.selectedQuote.name}" style="width:300px"
						rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
						requiredMessage="#{msgs.quoteNameRequiredMessage}">
						<rich:validator />
					</h:inputText>

					<h:outputText value="#{quoteForm.selectedQuote.name}"
						rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />

					<h:outputText value="#{msgs.number}" />
					<h:outputText value="#{quoteForm.selectedQuote.number}" />

					<h:outputText value="#{msgs.type}" />
					<h:outputText value="#{quoteForm.selectedQuote.type}"
						rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote or quoteForm.selectedQuote.id != null}" />
					<h:selectOneMenu value="#{quoteForm.selectedQuote.type}"
						rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote and quoteForm.selectedQuote.id == null}">
						<f:selectItem itemValue="Standard" />
						<f:selectItem itemValue="Co-Term" />
						<f:selectItem itemValue="Non Standard" />
					</h:selectOneMenu>

					<h:outputText value="#{msgs.version}" />
					<h:outputText value="#{quoteForm.selectedQuote.version}" />

					<h:outputText value="#{msgs.active}" />
					<h:panelGroup>
						<h:graphicImage value="./images/active.png"
							rendered="#{quoteForm.selectedQuote.isActive}" />
					</h:panelGroup>

					<h:outputText value="#{msgs.currency}" />
					<h:outputText value="#{quoteForm.selectedQuote.currencyIsoCode}"
						rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote or quoteForm.selectedQuote.id != null}" />
					<h:selectOneMenu value="#{quoteForm.selectedQuote.currencyIsoCode}"
						rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote and quoteForm.selectedQuote.id == null}">
						<f:selectItem itemValue="USD" />
						<f:selectItem itemValue="EUR" />
						<f:selectItem itemValue="GBP" />
					</h:selectOneMenu>

					<h:outputText value="#{msgs.payNow}" />
					<h:selectOneMenu value="#{quoteForm.selectedQuote.payNow}"
						rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}">
						<f:selectItem itemValue="Yes" />
						<f:selectItem itemValue="No" />
					</h:selectOneMenu>
					<h:outputText value="#{quoteForm.selectedQuote.payNow}"
						rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />

					<h:outputText value="#{msgs.amount}" />
					<h:outputText value="#{quoteForm.selectedQuote.amount}">
						<f:convertNumber
							locale="#{sforceSession.sessionUser.locale}"
							pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
					</h:outputText>

					<h:outputText value="#{msgs.owner}" />
					<h:panelGroup>
						<h:outputText id="ownerName"
							value="#{quoteForm.selectedQuote.ownerName}" />

						<h:outputText value=" " />

						<a4j:commandLink id="changeOwner"
							oncomplete="#{rich:component('ownerPanel')}.show()"
							action="#{quoteManager.editQuote(quoteForm.selectedQuote)}"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
							rerender="#{rich:clientId('ownerPanel')}" ajaxSingle="true">

							<h:graphicImage value="./images/search.png"
								title="#{msgs.change}" />

						</a4j:commandLink>

					</h:panelGroup>

					<h:outputText value="#{msgs.contact}" />
					<h:panelGroup>
						<h:outputText value="#{quoteForm.selectedQuote.contactName}" />

						<h:outputText value=" " />

						<a4j:commandLink id="changeContact"
							oncomplete="#{rich:component('contactPanel')}.show()"
							action="#{quoteManager.editQuote(quoteForm.selectedQuote)}"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
							reRender="#{rich:clientId('contactPanel')}" ajaxSingle="true">

							<h:graphicImage value="./images/search.png"
								title="#{msgs.change}" />

						</a4j:commandLink>

					</h:panelGroup>

					<h:outputText value="#{msgs.effectiveDate}" />
					<h:panelGroup>
						<h:outputText value="#{quoteForm.selectedQuote.effectiveDate}"
							rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />

						<rich:calendar value="#{quoteForm.selectedQuote.effectiveDate}"
							id="effectiveDate"
							locale="#{sforceSession.sessionUser.locale}" popup="true"
							datePattern="#{sforceSession.sessionUser.dateFormatPattern}"
							showApplyButton="false" cellWidth="24px" cellHeight="22px"
							style="width:200px"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
							disabled="false">
						</rich:calendar>

					</h:panelGroup>

					<h:outputText value="#{msgs.expirationDate}" />
					<h:panelGroup>
						<h:outputText value="#{quoteForm.selectedQuote.expirationDate}"
							rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />

						<rich:calendar value="#{quoteForm.selectedQuote.expirationDate}"
							id="expirationDate"
							locale="#{sforceSession.sessionUser.locale}" popup="true"
							datePattern="#{sforceSession.sessionUser.dateFormatPattern}"
							showApplyButton="false" cellWidth="24px" cellHeight="22px"
							style="width:200px"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
							disabled="false">
						</rich:calendar>
					</h:panelGroup>

					<h:outputText value="#{msgs.referenceNumber}" />
					<h:outputText value="#{quoteForm.selectedQuote.referenceNumber}"
						rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />
					<h:inputText value="#{quoteForm.selectedQuote.referenceNumber}"
						rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}" />

					<h:outputText value=" "
						rendered="#{empty quoteForm.selectedQuote or quoteForm.selectedQuote.type == 'Non Standard'}" />
					<h:outputText value=" "
						rendered="#{empty quoteForm.selectedQuote or quoteForm.selectedQuote.type == 'Non Standard'}" />

					<h:outputText value="#{msgs.term}"
						rendered="#{quoteForm.selectedQuote.type == 'Standard'}" />
					<h:panelGroup
						rendered="#{quoteForm.selectedQuote.type == 'Standard'}">
						<h:outputText value="#{quoteForm.selectedQuote.term}"
							rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />
						<h:selectOneMenu value="#{quoteForm.selectedQuote.term}"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}">
							<f:selectItem itemLabel="" itemValue="" />
							<f:selectItem itemLabel="1" itemValue="365" />
							<f:selectItem itemLabel="3" itemValue="1095" />
						</h:selectOneMenu>
					</h:panelGroup>

					<h:outputText value="#{msgs.endDate}"
						rendered="#{quoteForm.selectedQuote.type == 'Co-Term'}" />
					<h:panelGroup
						rendered="#{quoteForm.selectedQuote.type == 'Co-Term'}">
						<h:outputText value="#{quoteForm.selectedQuote.endDate}"
							rendered="#{quoteForm.opportunity.isClosed or empty quoteForm.selectedQuote}" />
						<rich:calendar value="#{quoteForm.selectedQuote.endDate}"
							id="endDate" locale="#{sforceSession.sessionUser.locale}"
							popup="true"
							datePattern="#{sforceSession.sessionUser.dateFormatPattern}"
							showApplyButton="false" cellWidth="24px" cellHeight="22px"
							style="width:200px"
							rendered="#{not quoteForm.opportunity.isClosed and not empty quoteForm.selectedQuote}"
							disabled="false">
						</rich:calendar>
					</h:panelGroup>

					<h:outputText value="#{msgs.createdBy}" />
					<h:panelGroup>
						<h:outputText value="#{quoteForm.selectedQuote.createdByName}" />
						<h:outputText value=", " escape="false"
							rendered="#{not empty quoteForm.selectedQuote}" />
						<h:outputText value="#{quoteForm.selectedQuote.createdDate}">
							<f:convertDateTime
								locale="#{sforceSession.sessionUser.locale}"
								pattern="#{sforceSession.sessionUser.dateTimeFormatPattern}"
								type="date" />
						</h:outputText>
					</h:panelGroup>
					<h:outputText value="#{msgs.lastModifiedBy}" />
					<h:panelGroup>
						<h:outputText
							value="#{quoteForm.selectedQuote.lastModifiedByName}" />
						<h:outputText value=", " escape="false"
							rendered="#{not empty quoteForm.selectedQuote}" />
						<h:outputText value="#{quoteForm.selectedQuote.lastModifiedDate}">
							<f:convertDateTime
								locale="#{sforceSession.sessionUser.locale}"
								pattern="#{sforceSession.sessionUser.dateTimeFormatPattern}"
								type="date" />
						</h:outputText>
					</h:panelGroup>

				</h:panelGrid>

				<br />

				<h:panelGroup style="display: block; text-align: right">

					<a4j:commandButton value="#{msgs.save}" styleClass="button"
						rendered="#{not empty quoteForm.selectedQuote}"
						action="#{quoteManager.saveQuote(quoteForm.selectedQuote)}"
						render="quoteList, details" ajaxSingle="true" status="ajaxStatus" />

					<h:outputText value=" " escape="false" />

					<a4j:commandButton value="#{msgs.cancel}" styleClass="button"
						rendered="#{not empty quoteForm.selectedQuote}" immediate="true"
						bypassUpdates="true" type="reset" render="details"
						ajaxSingle="true" execute="@this" />

				</h:panelGroup>

				<br />

				<hr />
				<rich:tabPanel switchType="client">
					<rich:tab header="#{msgs.quoteLineItems}">

						<h:panelGroup style="display: block; text-align: right">

							<a4j:commandButton id="importProducts"
								value="#{msgs.addOpportunityProducts}"
								action="#{quoteManager.addOpportunityLineItems(quoteForm.opportunity, quoteForm.selectedQuote)}"
								rendered="#{not empty quoteForm.selectedQuote}"
								render="quoteList, details"
								rerender="#{rich:clientId('addOpportunityProductsPanel')}"
								ajaxSingle="true" status="ajaxStatus" />

							<h:outputText value=" " escape="false" />


						</h:panelGroup>

						<rich:dataTable style="width: 100%" var="lineItem"
							value="#{quoteForm.selectedQuote.quoteLineItems}"
							rendered="#{not empty quoteForm.selectedQuote}">
							<rich:column>
								<f:facet name="header">#{msgs.productCode}</f:facet>
								<h:outputText value="#{lineItem.productCode}" />
							</rich:column>
							<rich:column>
								<f:facet name="header">#{msgs.configuredSku}</f:facet>
								<h:outputText value="#{lineItem.configuredSku}" />
							</rich:column>
							<rich:column>
								<f:facet name="header">#{msgs.description}</f:facet>
								<h:outputText value="#{lineItem.productDescription}" />
							</rich:column>
							<rich:column style="text-align: center;">
								<f:facet name="header">#{msgs.startDate}</f:facet>
								<h:outputText value="#{lineItem.startDate}">
									<f:convertDateTime
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#{sforceSession.sessionUser.dateFormatPattern}"
										type="date" />
								</h:outputText>
							</rich:column>
							<rich:column style="text-align: center;">
								<f:facet name="header">#{msgs.endDate}</f:facet>
								<h:outputText value="#{lineItem.endDate}">
									<f:convertDateTime
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#{sforceSession.sessionUser.dateFormatPattern}"
										type="date" />
								</h:outputText>
							</rich:column>
							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.listPrice}</f:facet>
								<h:outputText value="#{lineItem.listPrice}">
									<f:convertNumber
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
								</h:outputText>
							</rich:column>

							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.quantity}</f:facet>
								<h:outputText value="#{lineItem.quantity}" />
							</rich:column>

							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.unitPrice}</f:facet>
								<h:outputText value="#{lineItem.unitPrice}">
									<f:convertNumber
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
								</h:outputText>
							</rich:column>

							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.totalPrice}</f:facet>
								<h:outputText value="#{lineItem.totalPrice}">
									<f:convertNumber
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
								</h:outputText>
							</rich:column>

						</rich:dataTable>
					</rich:tab>
					<rich:tab header="#{msgs.invoiceSchedule}">
						<rich:dataTable style="width: 100%" var="lineItemSchedule"
							value="#{quoteForm.selectedQuote.quoteLineItemSchedules}"
							rendered="#{not empty quoteForm.selectedQuote}">

							<rich:column>
								<f:facet name="header">#{msgs.productCode}</f:facet>
								<h:outputText value="#{lineItemSchedule.productCode}" />
							</rich:column>
							<rich:column>
								<f:facet name="header">#{msgs.description}</f:facet>
								<h:outputText value="#{lineItemSchedule.productDescription}" />
							</rich:column>

							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.totalPrice}</f:facet>
								<h:outputText value="#{lineItemSchedule.prorateYearUnitPrice}">
									<f:convertNumber
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
								</h:outputText>
							</rich:column>

							<rich:column style="text-align: right;">
								<f:facet name="header">#{msgs.totalPrice}</f:facet>
								<h:outputText value="#{lineItemSchedule.prorateYearTotalPrice}">
									<f:convertNumber
										locale="#{sforceSession.sessionUser.locale}"
										pattern="#,##0.00;(#,##0.00)"></f:convertNumber>
								</h:outputText>
							</rich:column>



						</rich:dataTable>

					</rich:tab>

					<rich:tab header="#{msgs.discounts}">


					</rich:tab>
				</rich:tabPanel>
			</rich:panel>
		</a4j:outputPanel>

	</h:form>
</ui:composition>